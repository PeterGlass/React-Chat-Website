{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\peter\\\\Desktop\\\\React-Chat-Website\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef}from'react';import'./style/Chat.css';import Axios from'axios';import SimpleBar from'simplebar-react';import'simplebar/dist/simplebar.min.css';var hostURL=\"https://onlypeters.com\";//const hostURL = \"http://localhost:3001\";\nfunction Chat(props){var _useState=useState('(None)'),_useState2=_slicedToArray(_useState,2),alias=_useState2[0],setAlias=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),tempAlias=_useState4[0],setTempAlias=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),password=_useState6[0],setPassword=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),message=_useState8[0],setMessage=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),messageLog=_useState10[0],setMessageLog=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isNewUser=_useState12[0],setIsNewUser=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isLogin=_useState14[0],setIsLogin=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),hasError=_useState16[0],setHasError=_useState16[1];var _useState17=useState('test'),_useState18=_slicedToArray(_useState17,2),errorMessage=_useState18[0],setErrorMessage=_useState18[1];var _useState19=useState('BlurFlexContainer'),_useState20=_slicedToArray(_useState19,2),flexClass=_useState20[0],setFlexClass=_useState20[1];var _useState21=useState(0),_useState22=_slicedToArray(_useState21,2),sessionId=_useState22[0],setSessionId=_useState22[1];var _useState23=useState(0),_useState24=_slicedToArray(_useState23,2),userCount=_useState24[0],setUserCount=_useState24[1];var messagesEndRef=useRef(null);var _useWindowSize=useWindowSize(),_useWindowSize2=_slicedToArray(_useWindowSize,2),height=_useWindowSize2[0],width=_useWindowSize2[1];var scrollToBottom=function scrollToBottom(){messagesEndRef.current.scrollIntoView({behavior:\"smooth\"});};useEffect(scrollToBottom,[messageLog]);useEffect(function(){getMessageLog();setInterval(getMessageLog,500);},[]);useEffect(function(){getUserCount();setInterval(getUserCount,500);},[]);var cleanup=function cleanup(e){e.preventDefault();console.log(test);endSession();};useEffect(function(){window.addEventListener('beforeunload',cleanup);return function(){return window.removeEventListener('beforeunload',cleanup);};},[cleanup]);var getUserCount=function getUserCount(){Axios.get(hostURL+'/api/getUserCount').then(function(response){setUserCount(response.data[0].user_count);});};var startSession=function startSession(){Axios.get(hostURL+'/api/startSession',{params:{alias:tempAlias}}).then(function(response){setSessionId(response.data[1][0].session_id);});};var endSession=function endSession(){Axios.delete(hostURL+'/api/endSession',{data:{sessionId:sessionId}});setSessionId(0);};var getMessageLog=function getMessageLog(){Axios.get(hostURL+\"/api/getMessage\").then(function(response){setMessageLog(response.data);});};var sendMessage=function sendMessage(e){e.preventDefault();Axios.post(hostURL+'/api/insertMessage',{alias:alias,message:message});setMessage('');};var createUser=function createUser(e){e.preventDefault();Axios.get(hostURL+\"/api/isAliasUnique\",{params:{alias:tempAlias}}).then(function(response){if(response.data){console.log(tempAlias);if(tempAlias.length<=20){setAlias(tempAlias);setIsLogin(true);startSession();Axios.post(hostURL+\"/api/insertUser\",{alias:tempAlias,password:password});}else{setErrorMessage('Alias must be less than 20 characters.');setHasError(true);}}else{setErrorMessage('Alias has already been taken.');setHasError(true);}});};var userLogin=function userLogin(e){e.preventDefault();Axios.get(hostURL+\"/api/isUserAuth\",{params:{alias:tempAlias,password:password}}).then(function(response){if(response.data){setAlias(tempAlias);setIsLogin(true);startSession();}else{setErrorMessage('Account credentials are incorrect.');setHasError(true);}});};var openCreateAlias=function openCreateAlias(){setIsNewUser(true);setHasError(false);};var openLogin=function openLogin(){setIsNewUser(false);setHasError(false);};var logout=function logout(){setIsLogin(false);setAlias(\"(None)\");endSession();};useEffect(function(){if(isLogin){setFlexClass('FlexContainer');}else{setFlexClass('BlurFlexContainer');}},[isLogin]);useEffect(function(){if(!hasError){setErrorMessage('');}},[hasError]);var popClass;if(width>500){popClass='PopBox';}else{popClass='MobilePopBox';}return/*#__PURE__*/React.createElement(\"div\",null,!isNewUser&&!isLogin&&/*#__PURE__*/React.createElement(\"div\",{className:popClass},/*#__PURE__*/React.createElement(\"div\",{className:\"PopMessage\"},\"Use previously created alias and password to login. (Passwords cannot be recovered). \"),/*#__PURE__*/React.createElement(\"form\",{className:\"PopForm\",onSubmit:userLogin},/*#__PURE__*/React.createElement(\"input\",{className:\"AliasInput\",required:true,type:\"text\",placeholder:\"Alias\",onChange:function onChange(e){setTempAlias(e.target.value);}}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"input\",{className:\"PasswordInput\",type:\"password\",placeholder:\"Password\",onChange:function onChange(e){setPassword(e.target.value);}}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"button\",null,\"Login\")),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"button\",{className:\"PopSwitch\",required:true,onClick:openCreateAlias},\"Create new alias.\"),/*#__PURE__*/React.createElement(\"div\",{className:\"Error\"},errorMessage)),isNewUser&&!isLogin&&/*#__PURE__*/React.createElement(\"div\",{className:popClass},/*#__PURE__*/React.createElement(\"div\",{className:\"PopMessage\"},\"Create new alias. Bad passwords will be shamed. (Passwords cannot be recovered).\"),/*#__PURE__*/React.createElement(\"form\",{className:\"PopForm\",onSubmit:createUser},/*#__PURE__*/React.createElement(\"input\",{className:\"AliasInput\",required:true,type:\"text\",placeholder:\"Unique Alias\",onChange:function onChange(e){setTempAlias(e.target.value);}}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"input\",{className:\"PasswordInput\",required:true,type:\"password\",placeholder:\"Create Password\",onChange:function onChange(e){setPassword(e.target.value);}}),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"button\",null,\"Create Alias\")),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"button\",{className:\"PopSwitch\",onClick:openLogin},\"Login with alias.\"),/*#__PURE__*/React.createElement(\"div\",{className:\"Error\"},errorMessage)),/*#__PURE__*/React.createElement(\"div\",{className:flexClass},/*#__PURE__*/React.createElement(\"div\",{className:\"ChatBox ContainerItem\"},/*#__PURE__*/React.createElement(\"div\",{className:\"ChatHeader\"},/*#__PURE__*/React.createElement(\"div\",{className:\"OnlineUsers\"},/*#__PURE__*/React.createElement(\"span\",{className:\"OnlineBullet\"},\"\\u2022\"),\" Active Users: \",userCount),/*#__PURE__*/React.createElement(\"div\",{className:\"CurrentAlias\"},\"Alias: \",/*#__PURE__*/React.createElement(\"span\",{className:\"Alias\"},alias),\" | \"),/*#__PURE__*/React.createElement(\"button\",{className:\"LogoutButton\",disabled:!isLogin,onClick:logout},\"Logout\")),/*#__PURE__*/React.createElement(\"div\",{className:\"MessageBox\"},/*#__PURE__*/React.createElement(SimpleBar,{style:{height:\"100%\"}},messageLog.map(function(val){return/*#__PURE__*/React.createElement(\"div\",null,\"<\",/*#__PURE__*/React.createElement(\"span\",{className:\"Alias\"},val.alias),\"> \",val.message);}),/*#__PURE__*/React.createElement(\"div\",{ref:messagesEndRef}))),/*#__PURE__*/React.createElement(\"form\",{className:\"MessageForm\",onSubmit:sendMessage},/*#__PURE__*/React.createElement(\"input\",{className:\"MessageInput\",value:message,disabled:!isLogin,required:true,type:\"text\",placeholder:\"Message\",onChange:function onChange(e){setMessage(e.target.value);}}),/*#__PURE__*/React.createElement(\"button\",{className:\"SendButton\",disabled:!isLogin},\"Send\")))));function useWindowSize(){var _useState25=useState([window.innerHeight,window.innerWidth]),_useState26=_slicedToArray(_useState25,2),size=_useState26[0],setSize=_useState26[1];useEffect(function(){var handleResize=function handleResize(){setSize([window.innerHeight,window.innerWidth]);};window.addEventListener(\"resize\",handleResize);return function(){window.removeEventListener(\"resize\",handleResize);};},[]);return size;}}export default Chat;","map":{"version":3,"sources":["C:/Users/peter/Desktop/React-Chat-Website/client/src/Chat.js"],"names":["React","useEffect","useState","useRef","Axios","SimpleBar","hostURL","Chat","props","alias","setAlias","tempAlias","setTempAlias","password","setPassword","message","setMessage","messageLog","setMessageLog","isNewUser","setIsNewUser","isLogin","setIsLogin","hasError","setHasError","errorMessage","setErrorMessage","flexClass","setFlexClass","sessionId","setSessionId","userCount","setUserCount","messagesEndRef","useWindowSize","height","width","scrollToBottom","current","scrollIntoView","behavior","getMessageLog","setInterval","getUserCount","cleanup","e","preventDefault","console","log","test","endSession","window","addEventListener","removeEventListener","get","then","response","data","user_count","startSession","params","session_id","delete","sendMessage","post","createUser","length","userLogin","openCreateAlias","openLogin","logout","popClass","target","value","map","val","innerHeight","innerWidth","size","setSize","handleResize"],"mappings":"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","sourcesContent":["import React, {useEffect, useState, useRef} from 'react';\r\nimport './style/Chat.css';\r\nimport Axios from 'axios';\r\nimport SimpleBar from 'simplebar-react';\r\nimport 'simplebar/dist/simplebar.min.css';\r\n\r\nconst hostURL = \"https://onlypeters.com\";\r\n//const hostURL = \"http://localhost:3001\";\r\n\r\nfunction Chat(props) {\r\n    const [alias, setAlias] = useState('(None)');\r\n    const [tempAlias, setTempAlias] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [message, setMessage] = useState('');\r\n    const [messageLog, setMessageLog] = useState([]);\r\n    const [isNewUser, setIsNewUser] = useState(false);\r\n    const [isLogin, setIsLogin] = useState(false);\r\n    const [hasError, setHasError] = useState(false);\r\n    const [errorMessage, setErrorMessage] = useState('test');\r\n    const [flexClass, setFlexClass] = useState('BlurFlexContainer');\r\n    const [sessionId, setSessionId] = useState(0);\r\n    const [userCount, setUserCount] = useState(0);\r\n    const messagesEndRef = useRef(null);\r\n    const [height, width] = useWindowSize();\r\n\r\n    const scrollToBottom = () => {\r\n        messagesEndRef.current.scrollIntoView({ behavior: \"smooth\" });\r\n    }\r\n\r\n    useEffect(scrollToBottom, [messageLog]);\r\n\r\n    useEffect(() => {\r\n        getMessageLog();\r\n        setInterval(getMessageLog, 500);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        getUserCount();\r\n        setInterval(getUserCount, 500);\r\n    }, []);\r\n\r\n    const cleanup = (e) => {\r\n        e.preventDefault();\r\n        console.log(test);\r\n        endSession();\r\n    }\r\n\r\n    useEffect(() => {\r\n      \r\n        window.addEventListener('beforeunload', cleanup);\r\n      \r\n        return () => window.removeEventListener('beforeunload', cleanup);\r\n        \r\n      }, [cleanup]);\r\n\r\n    const getUserCount = () => {\r\n        Axios.get(hostURL + '/api/getUserCount').then((response) => {\r\n            setUserCount(response.data[0].user_count);\r\n        });\r\n    };\r\n\r\n    const startSession = () => {\r\n        Axios.get(hostURL + '/api/startSession',{\r\n            params: {\r\n                alias: tempAlias\r\n            }\r\n        }).then((response) => {\r\n            setSessionId(response.data[1][0].session_id);\r\n        });\r\n    };\r\n\r\n    const endSession = () => {\r\n        Axios.delete(hostURL + '/api/endSession',{\r\n            data: {\r\n                sessionId: sessionId\r\n            }\r\n        });\r\n        setSessionId(0);\r\n    };\r\n\r\n    const getMessageLog = () => {\r\n        Axios.get(hostURL + \"/api/getMessage\").then((response) => {\r\n            setMessageLog(response.data);\r\n        });\r\n    };\r\n\r\n    const sendMessage = (e) => {\r\n        e.preventDefault();\r\n        Axios.post(hostURL + '/api/insertMessage', {\r\n            alias: alias, \r\n            message: message\r\n        });\r\n        setMessage('');\r\n    };\r\n\r\n    const createUser = (e) => {\r\n        e.preventDefault();\r\n        Axios.get(hostURL + \"/api/isAliasUnique\", {\r\n            params: {\r\n                alias: tempAlias\r\n            }\r\n        }).then((response) => {\r\n            if(response.data){\r\n                console.log(tempAlias);\r\n                if(tempAlias.length <= 20){ \r\n                    setAlias(tempAlias);\r\n                    setIsLogin(true);\r\n                    startSession();\r\n                    Axios.post(hostURL + \"/api/insertUser\", {\r\n                        alias: tempAlias,\r\n                        password: password\r\n                    });\r\n                } else {\r\n                    setErrorMessage('Alias must be less than 20 characters.');\r\n                    setHasError(true);\r\n                } \r\n            } else {\r\n                setErrorMessage('Alias has already been taken.');\r\n                setHasError(true);\r\n            }\r\n        });\r\n    };\r\n\r\n    const userLogin = (e) => {\r\n        e.preventDefault();\r\n        Axios.get(hostURL + \"/api/isUserAuth\", {\r\n            params: {\r\n                alias: tempAlias,\r\n                password: password\r\n            }\r\n        }).then((response) => {\r\n            if(response.data){\r\n                setAlias(tempAlias);\r\n                setIsLogin(true);\r\n                startSession();\r\n            } else {\r\n                setErrorMessage('Account credentials are incorrect.');\r\n                setHasError(true);\r\n            }\r\n        });\r\n    };\r\n\r\n    const openCreateAlias = () => {\r\n        setIsNewUser(true);\r\n        setHasError(false);\r\n    };\r\n\r\n    const openLogin = () => {\r\n        setIsNewUser(false);\r\n        setHasError(false);\r\n    };\r\n\r\n    const logout = () => {\r\n        setIsLogin(false);\r\n        setAlias(\"(None)\");\r\n        endSession();\r\n    };\r\n\r\n    useEffect(() => {\r\n        if(isLogin){\r\n            setFlexClass('FlexContainer');\r\n        } else {\r\n            setFlexClass('BlurFlexContainer');\r\n        }\r\n    },[isLogin]);\r\n\r\n    useEffect(() => {\r\n        if(!hasError){\r\n            setErrorMessage('');\r\n        }\r\n    }, [hasError]);\r\n\r\n    let popClass;\r\n    if(width > 500){\r\n        popClass = 'PopBox';\r\n    } else {\r\n        popClass = 'MobilePopBox';\r\n    }\r\n\r\n    return(\r\n        <div>\r\n            {(!isNewUser && !isLogin) && <div className={popClass}>\r\n                <div className='PopMessage'>Use previously created alias and password to login. (Passwords cannot be recovered). </div>\r\n                <form className='PopForm' onSubmit={userLogin}>\r\n                    <input className='AliasInput' required type='text' placeholder='Alias' onChange={(e) => {\r\n                        setTempAlias(e.target.value);\r\n                    }}/><br/>\r\n                    <input className='PasswordInput' type='password' placeholder='Password' onChange={(e) => {\r\n                        setPassword(e.target.value);\r\n                    }}/><br/>\r\n                    <button>Login</button>\r\n                </form><br/>\r\n                <button className=\"PopSwitch\" required onClick={openCreateAlias}>Create new alias.</button>\r\n                <div className='Error'>{errorMessage}</div>\r\n            </div>}\r\n\r\n            {(isNewUser && !isLogin) && <div className={popClass}>\r\n            <div className='PopMessage'>Create new alias. Bad passwords will be shamed. (Passwords cannot be recovered).</div>\r\n                <form className='PopForm' onSubmit={createUser}>\r\n                    <input className='AliasInput' required type='text' placeholder='Unique Alias' onChange={(e) => {\r\n                        setTempAlias(e.target.value);\r\n                    }}/><br/>\r\n                    <input className='PasswordInput' required type='password' placeholder='Create Password' onChange={(e) => {\r\n                        setPassword(e.target.value);\r\n                    }}/><br/>\r\n                    <button>Create Alias</button>\r\n                </form><br/>\r\n                <button className=\"PopSwitch\" onClick={openLogin}>Login with alias.</button>\r\n                <div className='Error'>{errorMessage}</div>\r\n            </div>}\r\n            \r\n            <div className={flexClass}>\r\n                <div className='ChatBox ContainerItem'>\r\n                    <div className='ChatHeader'>\r\n                        <div className='OnlineUsers'>\r\n                            <span className='OnlineBullet'>&#8226;</span> Active Users: {userCount}\r\n                        </div>\r\n                        <div className='CurrentAlias'>Alias: <span className='Alias'>{alias}</span> | </div>\r\n                        <button className='LogoutButton' disabled={!isLogin} onClick={logout}>Logout</button>\r\n                    </div>\r\n                    <div className='MessageBox'>\r\n                        <SimpleBar style={{height: \"100%\" }}>\r\n                            {messageLog.map((val) => {\r\n                                return <div>&lt;<span className='Alias'>{val.alias}</span>&gt; {val.message}</div>\r\n                            })}\r\n                            <div ref={messagesEndRef} />\r\n                        </SimpleBar>\r\n                    </div>\r\n                    <form className='MessageForm' onSubmit={sendMessage}>\r\n                        <input className='MessageInput' value={message} disabled={!isLogin} required type='text' placeholder='Message' onChange={(e) => {\r\n                            setMessage(e.target.value);\r\n                        }}/>\r\n                        <button className='SendButton' disabled={!isLogin}>Send</button>\r\n                    </form>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    function useWindowSize() {\r\n        const [size, setSize] = useState([window.innerHeight, window.innerWidth]);\r\n        useEffect(() => {\r\n          const handleResize = () => {\r\n            setSize([window.innerHeight, window.innerWidth]);\r\n          };\r\n          window.addEventListener(\"resize\", handleResize);\r\n          return () => {\r\n            window.removeEventListener(\"resize\", handleResize);\r\n          };\r\n        }, []);\r\n        return size;\r\n      }\r\n}\r\n\r\nexport default Chat;\r\n"]},"metadata":{},"sourceType":"module"}